TYPE=TRIGGERS
triggers='CREATE DEFINER=`racktables`@`%` TRIGGER `Link-before-insert` BEFORE INSERT ON `Link` FOR EACH ROW LinkTrigger:BEGIN\n  DECLARE tmp, porta_type, portb_type, count INTEGER;\n\n  IF NEW.porta = NEW.portb THEN\n    # forbid connecting a port to itself\n    SET NEW.porta = NULL;\n    LEAVE LinkTrigger;\n  ELSEIF NEW.porta > NEW.portb THEN\n    # force porta < portb\n    SET tmp = NEW.porta;\n    SET NEW.porta = NEW.portb;\n    SET NEW.portb = tmp;\n  END IF; \n\n  # lock ports to prevent concurrent link establishment\n  SELECT type INTO porta_type FROM Port WHERE id = NEW.porta FOR UPDATE;\n  SELECT type INTO portb_type FROM Port WHERE id = NEW.portb FOR UPDATE;\n\n  # only permit the link if ports are compatibile\n  SELECT COUNT(*) INTO count FROM PortCompat WHERE (type1 = porta_type AND type2 = portb_type) OR (type1 = portb_type AND type2 = porta_type);\n  IF count = 0 THEN\n    SET NEW.porta = NULL;\n  END IF;\nEND' 'CREATE DEFINER=`racktables`@`%` TRIGGER `Link-before-update` BEFORE UPDATE ON `Link` FOR EACH ROW LinkTrigger:BEGIN\n  DECLARE tmp, porta_type, portb_type, count INTEGER;\n\n  IF NEW.porta = NEW.portb THEN\n    # forbid connecting a port to itself\n    SET NEW.porta = NULL;\n    LEAVE LinkTrigger;\n  ELSEIF NEW.porta > NEW.portb THEN\n    # force porta < portb\n    SET tmp = NEW.porta;\n    SET NEW.porta = NEW.portb;\n    SET NEW.portb = tmp;\n  END IF; \n\n  # lock ports to prevent concurrent link establishment\n  SELECT type INTO porta_type FROM Port WHERE id = NEW.porta FOR UPDATE;\n  SELECT type INTO portb_type FROM Port WHERE id = NEW.portb FOR UPDATE;\n\n  # only permit the link if ports are compatibile\n  SELECT COUNT(*) INTO count FROM PortCompat WHERE (type1 = porta_type AND type2 = portb_type) OR (type1 = portb_type AND type2 = porta_type);\n  IF count = 0 THEN\n    SET NEW.porta = NULL;\n  END IF;\nEND'
sql_modes=1415577600 1415577600
definers='racktables@%' 'racktables@%'
client_cs_names='utf8' 'utf8'
connection_cl_names='utf8_general_ci' 'utf8_general_ci'
db_cl_names='utf8_unicode_ci' 'utf8_unicode_ci'
created=155753583374 155753583377
